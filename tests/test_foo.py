import json
import unittest

from nlptk import PostProcess

import json
import unittest

from nlptk import JRValidate
from nlptk import JRMetrics
from pathlib import Path

class TestJRValidation(unittest.TestCase):

    def test_validation(self):
        # pp = PostProcess()
        # # jr = '{ "basics": { "name": "NAWSHIN ZAMAN", "email": "nawshin.zaman8@gmail.com", "label": "Buyer", "phone": "403-629-0454", "summary": "PROCUREMENT SPECIALIST Results-driven procurement professional with extensive experience in materials and services procuring, vendor relations, and purchase order management. Adept at ensuring timely procurement of goods, reconciling accounts payable, and maintaining compliance with corporate policies. Recognized for excellent communication and organization skills", "location": { "city": "Calgary", "region": "Alberta", "address": null, "postalCode": "T3P 1A9", "countryCode": "Canada" }, "profiles": [] }, "work": [ { "name": "CANADIAN NATURAL RESOURCES LTD", "endDate": null, "summary": null, "location": "Calgary", "position": "Buyer", "startDate": "2022-01-15", "highlights": ["Served as Subject Matter Expert (SME) in procurement processes, specializing in materials sourcing and vendor management Established and maintained vendor networks to gather quotes for best pricing Reviewed Purchase Requisitions and converted them into Purchase Orders for up to $1 million, ensuring policy compliance Tracked Purchase Orders after issuance and resolved issues related to delivery discrepancies Assisted in accounts payable reconciliation to ensure accurate financial processing Trained new buyers and business stakeholders on procurement systems and policies"], "description": null }, { "name": "Trans MOUNTAIN", "endDate": "2021-12-15", "summary": null, "location": "Calgary", "position": "Buyer", "startDate": "2019-01-15", "highlights": ["Managed procurement for critical site projects, ensuring timely acquisition of materials and rental equipment Established and maintained relationships with vendors, obtaining competitive quotes Expedited critical materials to prevent project delays, working closely with logistics teams Tracked Purchase Order after issuance, resolved issues related to delivery discrepancies, and documented received goods Assisted accounts payable with invoice reconciliation, reducing payment issues Trained new hires on procurement systems and policies"], "description": null }, { "name": "LAFARGE CANADA", "endDate": "2019-12-15", "summary": null, "location": "Calgary", "position": "Buyer", "startDate": "2016-01-15", "highlights": ["Reviewed Purchase Requisitions and created Purchase Orders for a $2M portfolio, ensuring adherence to Procurement policies Tracked Purchase Orders, resolved issues related to delivery discrepancies and documented received goods Issued Blanket Purchase Orders for annual services in accordance to the negotiated price list Worked closely with the Warehouse Supervisor to source materials for Inventory replenishment Assisted accounts payable with invoice reconciliation, reducing payment discrepancies Trained new hires on procurement systems and policies"], "description": null }, { "name": "BOW VALLEY COLLEGE", "endDate": "2016-12-15", "summary": null, "location": "Calgary", "position": "Junior Buyer", "startDate": "2014-01-15", "highlights": ["Created and issued Purchase Orders while ensuring compliance with procurement policies Tracked and expedited Purchase Orders to guarantee on-time deliveries Resolved discrepancies in product deliveries and documented received goods Assisted accounts payable with invoice reconciliation, reducing payment discrepancies"], "description": null } ], "volunteer": [], "education": [ { "area": "Finance", "score": null, "courses": [], "endDate": null, "startDate": null, "studyType": "Bachelor of Management", "institution": "University of Lethbridge" }, { "area": "Supply Chain Management", "score": null, "courses": [], "endDate": null, "startDate": null, "studyType": "Diploma", "institution": "SAIT" } ], "awards": [], "certificates": [], "publications": [], "skills": [ { "name": "Purchase Order Processing & Tracking" }, { "name": "Rental Equipment & Service" }, { "name": "Procurement" }, { "name": "Accounts Payable Reconciliation" }, { "name": "Expediting & Logistics Coordination" }, { "name": "Training & Process Improvement" }, { "name": "ERP Systems : SAP" }, { "name": "Maximo" }, { "name": "PeopleSoft" }, { "name": "Microsoft D365" }, { "name": "Ivalua & Microsoft Office" } ], "languages": [], "interests": [], "references": [], "projects": [] }'
        # # jr = '{ "basics": { "name": null, "email": "latif.kpegouni.etu@univ-lille.fr", "label": "PROCESS INTEGRATOR & CABLER", "phone": "+33635643066", "summary": "Master s student in Electronics Technologies for Smart Devices.", "location": { "city": "Combemale", "region": "FR-FR", "address": "4Rue Fr d ric", "postalCode": null, "countryCode": "FR" }, "profiles": [ { "network": "Linkedin", "username": null } ] }, "work": [ { "name": "CONTOUR GLOBALE", "endDate": "2022-07-14", "summary": null, "location": null, "position": "PROCESS INTEGRATOR & CABLER", "startDate": "2021-08-14", "highlights": ["Project to strengthen the video surveillance system and install an access control system at CONTOUR GLOBALE TOGO AUGUST 2022 : Network analysis service with the PCE-PA 8000 analyzer at the DJAGBLE petroleum products and supermarket sales station in Lom Togo"], "description": null }, { "name": "University of Lille", "endDate": "2026-12-14", "summary": null, "location": null, "position": "MASTER in ELECTRONICS", "startDate": "2024-01-14", "highlights": ["TECHNOLOGIES FOR SMART COMMUNICATING DEVICES Proficiency in signal processing and modeling tools. Master microfabrication techniques. Design of communicating objects."], "description": null } ], "volunteer": [], "education": [ { "area": "Electronics", "score": null, "courses": [], "endDate": "2024-12-14", "startDate": "2023-01-14", "studyType": "BACHELOR S", "institution": "University of Lille" }, { "area": "Electronics", "score": null, "courses": [], "endDate": "2023-12-14", "startDate": "2023-01-14", "studyType": "MASTER", "institution": "University of Lille" }, { "area": "Electronics", "score": null, "courses": [], "endDate": "2023-11-14", "startDate": "2020-10-14", "studyType": "MASTER", "institution": "University of Lille" } ], "awards": [], "certificates": [], "publications": [], "skills": [ { "name": "Time management" }, { "name": "Team spirit" }, { "name": "Ability to work independently" }, { "name": "Flexibility" }, { "name": "Im looking for an end-of-studies internship contract starting from February 2025 in microelectronic ideally for a duration of 2-5 months." }, { "name": "KPEGOUNI Latif" }, { "name": "MICROSOFT OFFICE (word" }, { "name": "Excel and power point.)" }, { "name": "Semiconductors and MEMS" }, { "name": "SILVACO" }, { "name": "Klayout" }, { "name": "COMSOL" }, { "name": "PCB Design" }, { "name": "Proteus kicad" }, { "name": "Eagle" }, { "name": "Signal Processing and Telecommunications" }, { "name": "ADDS" }, { "name": "Matlab Scilab" }, { "name": "CST Studio" }, { "name": "LabVIEW" }, { "name": "Microcontrollers" }, { "name": "ARDUINO" }, { "name": "ESP" }, { "name": "OTHERS" }, { "name": "VHDL C" }, { "name": "LTSpice - OSCILLOSCOPE" } ], "languages": [ { "fluency": "fluent", "language": "English" }, { "fluency": "fluent", "language": "French" } ], "interests": [], "references": [], "projects": [] }'
        # jr = '{ "basics": { "name": "NAWSHIN ZAMAN", "email": "nawshin.zaman8@gmail.com", "label": "Buyer", "phone": "403-629-0454", "summary": "PROCUREMENT SPECIALIST Results-driven procurement professional with extensive experience in materials and services procuring, vendor relations, and purchase order management. Adept at ensuring timely procurement of goods, reconciling accounts payable, and maintaining compliance with corporate policies. Recognized for excellent communication and organization skills", "location": { "city": "Calgary", "region": "Alberta", "address": null, "postalCode": "T3P 1A9", "countryCode": "Canada" }, "profiles": [] }, "work": [ { "name": "CANADIAN NATURAL RESOURCES LTD", "endDate": null, "summary": null, "location": "Calgary", "position": "Buyer", "startDate": "2022-01-15", "highlights": ["Served as Subject Matter Expert (SME) in procurement processes, specializing in materials sourcing and vendor management Established and maintained vendor networks to gather quotes for best pricing Reviewed Purchase Requisitions and converted them into Purchase Orders for up to $1 million, ensuring policy compliance Tracked Purchase Orders after issuance and resolved issues related to delivery discrepancies Assisted in accounts payable reconciliation to ensure accurate financial processing Trained new buyers and business stakeholders on procurement systems and policies"], "description": null }, { "name": "Trans MOUNTAIN", "endDate": "2021-12-15", "summary": null, "location": "Calgary", "position": "Buyer", "startDate": "2019-01-15", "highlights": ["Managed procurement for critical site projects, ensuring timely acquisition of materials and rental equipment Established and maintained relationships with vendors, obtaining competitive quotes Expedited critical materials to prevent project delays, working closely with logistics teams Tracked Purchase Order after issuance, resolved issues related to delivery discrepancies, and documented received goods Assisted accounts payable with invoice reconciliation, reducing payment issues Trained new hires on procurement systems and policies"], "description": null }, { "name": "LAFARGE CANADA", "endDate": "2019-12-15", "summary": null, "location": "Calgary", "position": "Buyer", "startDate": "2016-01-15", "highlights": ["Reviewed Purchase Requisitions and created Purchase Orders for a $2M portfolio, ensuring adherence to Procurement policies Tracked Purchase Orders, resolved issues related to delivery discrepancies and documented received goods Issued Blanket Purchase Orders for annual services in accordance to the negotiated price list Worked closely with the Warehouse Supervisor to source materials for Inventory replenishment Assisted accounts payable with invoice reconciliation, reducing payment discrepancies Trained new hires on procurement systems and policies"], "description": null }, { "name": "BOW VALLEY COLLEGE", "endDate": "2016-12-15", "summary": null, "location": "Calgary", "position": "Junior Buyer", "startDate": "2014-01-15", "highlights": ["Created and issued Purchase Orders while ensuring compliance with procurement policies Tracked and expedited Purchase Orders to guarantee on-time deliveries Resolved discrepancies in product deliveries and documented received goods Assisted accounts payable with invoice reconciliation, reducing payment discrepancies"], "description": null } ], "volunteer": [], "education": [ { "area": "Finance", "score": null, "courses": [], "endDate": null, "startDate": null, "studyType": "Bachelor of Management", "institution": "University of Lethbridge" }, { "area": "Supply Chain Management", "score": null, "courses": [], "endDate": null, "startDate": null, "studyType": "Diploma", "institution": "SAIT" } ], "awards": [], "certificates": [], "publications": [], "skills": [ { "name": "Purchase Order Processing & Tracking" }, { "name": "Rental Equipment & Service" }, { "name": "Procurement" }, { "name": "Accounts Payable Reconciliation" }, { "name": "Expediting & Logistics Coordination" }, { "name": "Training & Process Improvement" }, { "name": "ERP Systems : SAP" }, { "name": "Maximo" }, { "name": "PeopleSoft" }, { "name": "Microsoft D365" }, { "name": "Ivalua & Microsoft Office" } ], "languages": [], "interests": [], "references": [], "projects": [] }'
        #
        # result, is_valid_json, is_valid_jsonresume = pp.postprocess(jr)
        #
        # print()
        # print(f"is_valid_json:        {is_valid_json}")
        # print(f"is_valid_jsonresume:  {is_valid_jsonresume}")
        # print()
        # print(json.dumps(result, indent=2))

        # ----------------------------------------------------------------------a
        home = Path.home()
        data_dir = home.joinpath("Data/Jobscan/Resumes/v1.1model_analysis/data2")
        inpath = data_dir.joinpath("merged_data.jsonl")
        data = [json.loads(x) for x in open(inpath)]

        # idx = 1073 # bad data - ignore
        idx = 10
        d = data[idx]
        # print(json.dumps(d["jsonresume_v1"], indent=2))


        jrm = JRMetrics(approach="regex")
        # dvt_2 = jrm.measure_dict_v_text(d, "jsonresume_v1")
        # print(json.dumps(dvt_2, indent=2))

        dvd_1 = jrm.measure_dict_v_dict(d, "jsonresume_rchilli", "jsonresume_v2")
        print(json.dumps(dvd_1, indent=2))



if __name__ == '__main__':
    unittest.main()








